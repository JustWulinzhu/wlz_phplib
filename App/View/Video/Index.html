<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


    <style>
        <!--        /*隐藏video 音量按钮*/-->
        <!--        video::-webkit-media-controls-mute-button {-->
        <!--            display: none !important;-->
        <!--        }-->

        <!--        /*隐藏video 当前按钮*/-->
        <!--           video::-webkit-media-controls-current-time-display {-->
                       <!--               display: none !important;-->
                       <!--           }-->

        <!--        /*隐藏video 总时间*/-->
        <!--           video::-webkit-media-controls-time-remaining-display {-->
                       <!--               display: none !important;-->
                       <!--           }-->

        <!--        /*隐藏video 全屏按钮*/-->
        <!--           video::-webkit-media-controls-fullscreen-button {-->
                       <!--               display: none !important;-->
                       <!--           }-->
        <!--        video::-webkit-media-controls-timeline {-->
                    <!--            display: none;-->
                    <!--        }-->
        <!--        video::-webkit-media-controls-play-button { display: none; }-->

        * {margin:0;padding:0;}
        .wrap{
            width:100%;
            position:relative;
            height: 550px;
            background-color: black;
            margin-top: 50px;
        }
        video{
            object-fit: contain;
            /*position: absolute;*/
            height: 100%;
            width: 100%;
        }
        .img {
            margin-top: 1px;
            text-align: center;
        }
        h1 {
            text-align: center;
            margin-top: 50px;
            font-size: 70px;
        }
        #heiping {
            position: absolute;
            margin-top: 60px;
            width: 100%;
            height: 120%;
        }
        #grep_line {
            width: 100%;
            height: 11px;
            background-color: #888888;
        }

    </style>

    <script>
        let globalVideo = null;
        function myhidden() {
            var video = document.getElementById("videoID");
            video.style.display = "none";
        }

        document.addEventListener("visibilitychange", function () {
            if (!document.hidden) {   //处于当前页面
                location.reload();
            }
        });

        console.log("{{IS_LOOKED}}");
        window.onload=function() { //页面打开即执行
            if ("{{IS_LOOKED}}" == "unlooked") {
            $(document).ready(function() {
                console.log("添加video成功");
                var video_str = "<video\n" +
                    "            id=\"videoID\"\n" +
                    "            autoplay muted\n" +
                    "            x5-video-player-fullscreen=\"true\"\n" +
                    "            x5-playsinline\n" +
                    "            playsinline\n" +
                    "            webkit-playsinline\n" +
                    "            disablePictureInPicture=\"true\"\n" +
                    "            controlslist=\"nomutebutton notimeline nodownload nofullscreen noremoteplayback noplaybackrate\"\n" +
                    "            onended=myhidden()\n" +
                    "    >\n" +
                    "        <source id=\"source\" src='{{IMAGE_URL}}' type=\"video/mp4\">\n" +
                    "        您的浏览器不支持 video 标签。\n" +
                    "    </video>";
                $("#wrap").append(video_str);
                //  <source id=\"source\" src={{IMAGE_URL}} type=\"video/mp4\">\n"
                globalVideo= document.getElementById("videoID");
                // 提出后台视频暂停时触发
                globalVideo.addEventListener("pause",function(){
                    if(globalVideo && globalVideo.duration ){
                        let duration =globalVideo.duration ||0;//视频时长，秒
                        let currentTime =globalVideo.currentTime||0//当前播放时长。秒
                        saveTime(currentTime,duration)
                    }

                })
            })
            } else {
                console.log("没有添加video");
            }

        };

        window.onunload = function () {
            let onunloadVideo=document.getElementById('videoID');
            if(onunloadVideo && onunloadVideo.duration ){
                let duration =onunloadVideo.duration ||0;//视频时长，秒
                let currentTime =onunloadVideo.currentTime||0//当前播放时长。秒
                saveTime(currentTime,duration)
            }
            // 发送请求
            location.reload();
        }

        function saveTime(currentTime, duration) {
            console.log('duration',duration,currentTime)
            var formData = new FormData();
            formData.append("currentTime",currentTime);
            formData.append('duration', duration);
            console.log('触发了Ajax',duration,currentTime)
            $.ajax({
                url : "{{APP_DOMAIN}}" + "/mooc/Dorecord",
                type : "POST",
                data : formData,
                contentType : false,
                processData : false,
                dataType : 'json',
                success : function(response) {
                    if (200 === response.code) {
                    } else {
                    }
                }
            });
        }
    </script>

</head>
<body>

<div class="wrap" id="wrap">
    <!--    <video-->
    <!--            id="videoID"-->
    <!--            autoplay muted-->
    <!--            x5-video-player-fullscreen="true"-->
    <!--            x5-playsinline-->
    <!--            playsinline-->
    <!--            webkit-playsinline-->
    <!--            disablePictureInPicture="true"-->
    <!--            controlslist="nomutebutton notimeline nodownload nofullscreen noremoteplayback noplaybackrate"-->
    <!--            onended=myhidden()-->
    <!--    >-->
    <!--        <source id="source" src={{IMAGE_URL}} type="video/mp4">-->
    <!--        您的浏览器不支持 video 标签。-->
    <!--    </video>-->

    <!--    <img id="heiping"  src="{{APP_STATIC_PATHS}}/mooc/images/heiping.png">-->
</div>
<div id="grep_line"> </div>
<div>image::{{IMAGE_URL}}</div>
<div>IS_LOOKED::{{IS_LOOKED}}</div>

<!--<div class="img">-->
<!--    <img width="50%" height="300" src="{{IMAGE_URL}}">-->
<!--</div>-->

<!--<h1>{{DES}}</h1>-->

</body>
</html>