<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


    <style>
        <!--        /*隐藏video 音量按钮*/-->
        <!--        video::-webkit-media-controls-mute-button {-->
        <!--            display: none !important;-->
        <!--        }-->

        <!--        /*隐藏video 当前按钮*/-->
        <!--           video::-webkit-media-controls-current-time-display {-->
                       <!--               display: none !important;-->
                       <!--           }-->

        <!--        /*隐藏video 总时间*/-->
        <!--           video::-webkit-media-controls-time-remaining-display {-->
                       <!--               display: none !important;-->
                       <!--           }-->

        <!--        /*隐藏video 全屏按钮*/-->
        <!--           video::-webkit-media-controls-fullscreen-button {-->
                       <!--               display: none !important;-->
                       <!--           }-->
        <!--        video::-webkit-media-controls-timeline {-->
                    <!--            display: none;-->
                    <!--        }-->
        <!--        video::-webkit-media-controls-play-button { display: none; }-->

        * {margin:0;padding:0;}
        .wrap{
            width:100%;
            position:relative;
            height: 550px;
            background-color: black;
            margin-top: 50px;
        }
        video{
            object-fit: contain;
            /*position: absolute;*/
            height: 100%;
            width: 100%;
        }
        .img {
            margin-top: 1px;
            text-align: center;
        }
        h1 {
            text-align: center;
            margin-top: 50px;
            font-size: 70px;
        }
        #heiping {
            position: absolute;
            margin-top: 60px;
            width: 100%;
            height: 120%;
        }
        #grep_line {
            width: 100%;
            height: 11px;
            background-color: #888888;
        }

    </style>

    <script>
        function myhidden() {
            var video = document.getElementById("videoID");
            video.style.display = "none";
        }

        console.log("{{IS_LOOKED}}");
        window.onload=function() { //页面打开即执行
            if ("{{IS_LOOKED}}" == "unlooked") {
                $(document).ready(function() {
                    console.log("添加video成功");
                    var video_str = "<video\n" +
                        "            id=\"videoID\"\n" +
                        "            autoplay muted\n" +
                        "            x5-video-player-fullscreen=\"true\"\n" +
                        "            x5-playsinline\n" +
                        "            playsinline\n" +
                        "            webkit-playsinline\n" +
                        "            disablePictureInPicture=\"true\"\n" +
                        "            controlslist=\"nomutebutton notimeline nodownload nofullscreen noremoteplayback noplaybackrate\"\n" +
                        "            onended=myhidden()\n" +
                        "    >\n" +
                        "        <source id=\"source\" src={{IMAGE_URL}} type=\"video/mp4\">\n" +
                        "        您的浏览器不支持 video 标签。\n" +
                        "    </video>";
                    $("#wrap").append(video_str);
                })
            } else {
                console.log("没有添加video");
            }

            function ajax(currentTime, duration) {
                var formData = new FormData();
                formData.append("currentTime",currentTime);
                formData.append('duration', duration);

                $.ajax({
                    url : "{{APP_DOMAIN}}" + "/mooc/Dorecord",
                    type : "POST",
                    data : formData,
                    contentType : false,
                    processData : false,
                    dataType : 'json',
                    success : function(response) {
                        if (200 === response.code) {

                        } else {

                        }
                    }
                });
            }

            function getTime() {
                var videoSize = document.querySelector("#videoID");
                videoSize .addEventListener("loadedmetadata", function () {
                    sessionStorage.setItem('session', parseInt(videoSize.duration));
                });
            }
            getTime();

            var i = 0;
            var timer = setInterval(function () {
                i++;
                sessionStorage.setItem('time', i);
                if (i>600) {
                   clearInterval(timer);
                }
            },1000)

            document.addEventListener('visibilitychange', () => {
                var time = sessionStorage.getItem('time');
                var total_time = sessionStorage.getItem('session');
                if (time >= total_time) {
                    time = total_time;
                }
                if (document.visibilityState == "visible") {
                    ajax(time, total_time);
                } else {
                    ajax(time, total_time);
                }
            })

            // window.onunload = function () {
            //     ajax('ceshi1', 'ceshi2');
            // }
        };

    </script>

</head>
<body>

<div class="wrap" id="wrap">
<!--    <video-->
<!--            id="videoID"-->
<!--            autoplay muted-->
<!--            x5-video-player-fullscreen="true"-->
<!--            x5-playsinline-->
<!--            playsinline-->
<!--            webkit-playsinline-->
<!--            disablePictureInPicture="true"-->
<!--            controlslist="nomutebutton notimeline nodownload nofullscreen noremoteplayback noplaybackrate"-->
<!--            onended=myhidden()-->
<!--    >-->
<!--        <source id="source" src={{IMAGE_URL}} type="video/mp4">-->
<!--        您的浏览器不支持 video 标签。-->
<!--    </video>-->

<!--    <img id="heiping"  src="{{APP_STATIC_PATHS}}/mooc/images/heiping.png">-->
</div>
<div id="grep_line"> </div>

<!--<div class="img">-->
<!--    <img width="50%" height="300" src="{{IMAGE_URL}}">-->
<!--</div>-->

<!--<h1>{{DES}}</h1>-->

</body>
</html>